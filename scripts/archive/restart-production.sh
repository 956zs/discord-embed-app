#!/bin/bash

# ============================================================================
# é‡å•Ÿç”Ÿç”¢ç’°å¢ƒæœå‹™
# ============================================================================

set -e

echo "ğŸ”„ é‡å•Ÿç”Ÿç”¢ç’°å¢ƒæœå‹™..."
echo ""

# åœæ­¢èˆŠæœå‹™
echo "â¹ï¸  åœæ­¢èˆŠæœå‹™..."
pm2 delete all 2>/dev/null || echo "   æ²’æœ‰é‹è¡Œä¸­çš„æœå‹™"

# ç­‰å¾…ä¸€ä¸‹
sleep 2

# å•Ÿå‹•æ–°æœå‹™
echo ""
echo "ğŸš€ å•Ÿå‹•æ–°æœå‹™..."
pm2 start ecosystem.config.js

# ä¿å­˜é…ç½®
pm2 save

# ç­‰å¾…æœå‹™å•Ÿå‹•
echo ""
echo "â³ ç­‰å¾…æœå‹™å•Ÿå‹•..."
sleep 5

# é¡¯ç¤ºç‹€æ…‹
echo ""
echo "ğŸ“Š æœå‹™ç‹€æ…‹:"
pm2 status

echo ""
echo "âœ… é‡å•Ÿå®Œæˆï¼"
echo ""
echo "æŸ¥çœ‹æ—¥èªŒ:"
echo "  pm2 logs discord-server  # Server + Bot æ—¥èªŒ"
echo "  pm2 logs discord-client  # Client æ—¥èªŒ"
echo ""
