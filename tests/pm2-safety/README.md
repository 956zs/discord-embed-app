# PM2 安全操作測試

本目錄包含 PM2 安全操作規範的完整測試套件。

## 測試文件

### test-pm2-safety.sh
完整的 PM2 安全操作驗證腳本，包含 11 個測試場景。

**測試內容**：
- 進程創建和狀態驗證
- 管理命令測試 (stop, start, restart)
- 腳本安全性檢查
- 函數存在性驗證
- 錯誤處理測試
- 進程名稱常量驗證
- 最終隔離性驗證

**執行方式**：
```bash
cd ~/discord-embed-app
./tests/pm2-safety/test-pm2-safety.sh
```

### test-mode-switch.sh
模式切換功能驗證腳本，包含 7 個測試場景。

**測試內容**：
- 測試進程創建
- 當前模式檢查
- 模式一致性驗證
- 模式切換命令測試
- 安全函數使用驗證
- 進程衝突檢查

**執行方式**：
```bash
cd ~/discord-embed-app
./tests/pm2-safety/test-mode-switch.sh
```

### PM2_SAFETY_TEST_RESULTS.md
完整的測試結果文檔，包含：
- 測試概述和環境
- 詳細測試結果
- 驗證的需求
- 測試覆蓋率
- 結論和建議

## 測試目的

這些測試確保：

1. ✅ **隔離性** - 所有 PM2 操作只影響 Discord 應用進程
2. ✅ **安全性** - 絕不使用全域命令（如 `pm2 delete all`）
3. ✅ **可靠性** - 優雅處理錯誤情況
4. ✅ **可追蹤性** - 完整的操作日誌
5. ✅ **多應用支援** - 不影響其他 PM2 進程

## 何時執行測試

建議在以下情況執行測試：

- ✅ 首次部署後
- ✅ 修改管理腳本後
- ✅ 更新 PM2 版本後
- ✅ 生產環境部署前
- ✅ 定期驗證（每月）

## 測試結果

最後測試日期：2024年

**基本安全測試**：16 項通過，0 項失敗  
**模式切換測試**：9 項通過，0 項失敗

所有測試通過！PM2 安全操作驗證成功。

## 相關文檔

- [PM2 安全操作文檔](../../docs/PM2_SAFETY.md)
- [完整部署指南](../../COMPLETE_DEPLOYMENT_GUIDE.md)
- [快速參考](../../QUICK_REFERENCE.md)

## 問題報告

如果測試失敗，請：

1. 查看測試輸出的錯誤信息
2. 檢查 `scripts/pm2-utils.sh` 是否存在
3. 檢查管理腳本是否正確引入 pm2-utils.sh
4. 提交 Issue 到 GitHub，附上測試輸出

---

**注意**：這些測試會創建臨時的測試進程，測試完成後會自動清理。測試不會影響正在運行的 Discord 應用進程。
